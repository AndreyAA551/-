$(function(){if(jQuery().isotope){var e=$(".etc-news .grid").isotope({itemSelector:".grid-item",percentPosition:!0,masonry:{columnWidth:".grid-sizer"}});e.find("img").on("load",function(t){e.isotope("layout")})}}),$(function(){jQuery().metisMenu&&($(".navbar-toggle").on("click",function(){$("body").toggleClass("open"),$("#menu1").find('> li[class="active"] > a').trigger("click")}),$("#menu1").metisMenu().on("show.metisMenu",function(t){$(this).find("> li").css({opacity:.2}),$(t.target).closest("li").css({opacity:1})}).on("shown.metisMenu",function(t){$(this).find("> li").css({opacity:.2}),$(t.target).closest("li").css({opacity:1})}).on("hide.metisMenu",function(t){}).on("hidden.metisMenu",function(t){$(this).find("> li").css({opacity:1})}))}),$(function(){if(jQuery().nrgTracking){var t=$("#etcTracking").nrgTracking(),i=$('[name="docNum"]',t),n=$('[type="submit"]',t);t.on("submit.nrgTracking",function(t){n.button("loading");var e=$.trim(i.val()),a="//"+window.location.hostname+window.location.pathname+"#"+e;e&&(window.location.replace(a),"undefined"!=typeof ymaps&&Ya.share2("yaShare",{content:{title:"ТК Энергия. Состояние накладной № "+e,description:'Сервис отслеживания груза транспортной компании "Энергия"',url:a}}))}),t.on("always.etc.tracking",function(t,e){n.button("reset")}),t.on("success.etc.tracking",function(t,e){});var e=location.hash;if(e){var a=$.trim(decodeURI(e.substring(1)));i.val(a),t.trigger("submit.nrgTracking")}}}),$(function(){if(jQuery().calculator){function t(){}t.prototype={weight:t.prototype.decimal={validators:{notEmpty:{},callback:{message:t.prototype.messageDecimalSeparator='(десятичные числа вводятся с использованием "." или ",")',callback:t.prototype.decimalSeparator=function(t,e,a){var i=t.replace(/\,/g,".");return!!i&&(a.val(i),!0)}},numeric:{}}},length:t.prototype.decimal,width:t.prototype.decimal,height:t.prototype.decimal,volume:t.prototype.decimal,decimal:t.prototype.decimal,places:{validators:{notEmpty:{message:"Пожалуйста введите количество"},digits:{},callback:{message:"?",callback:function(t,e,a){return""===t||(t<1?{valid:!1,message:"Не менее 1"}:!(1e3<t)||{valid:!1,message:"Не более 1000"})}}}},city:{excluded:!1,onSuccess:function(t,e){var a=$(t.target).data("target"),i=$('[name="'+a+'"]',m);e.bv.updateStatus(i,"VALID").validateField(i)},onError:function(t,e){var a=$(t.target).data("target"),i=$('[name="'+a+'"]',m);e.bv.updateStatus(i,"INVALID").validateField(i).updateMessage(i,"notEmpty","Пожалуйста, введите город!"),e.element.data("bv.messages").find('.help-block[data-bv-for="'+e.field+'"]').hide()},validators:{notEmpty:{},numeric:{message:"Пожалуйста, выберите город"}}}};var o=new t,m=$('[data-target="calculator"]'),n=m.find('[type="submit"]'),c=$('[data-template="packaging"]').detach(),e=$('[data-provide="packagings"]').hide();m.calculator({submitButton:!1}).bootstrapValidator({feedbackIcons:{valid:null,invalid:null,validating:null},fields:{"item.weight":o.weight,"item.length":o.length,"item.width":o.width,"item.height":o.height,"item.volume":o.volume,"item.places":o.places,cityFrom:o.city,cityTo:o.city,declaredCargoPrice:o.decimal,cityFromName:{validators:{notEmpty:{}}},cityToName:{validators:{notEmpty:{}}}},submitButtons:'[type="submit"]'}).on("error.field.bv",function(t,e){e.element.closest(".form-group").find('.help-block[data-bv-result="INVALID"]').hide(),m.find(".has-warning").removeClass("has-warning"),m.find(".help-block.text-warning").remove(),e.bv.getSubmitButton()&&e.bv.disableSubmitButtons(!0),n.button("reset").removeClass("hide"),m.calculator("destroyResult")}).on("success.field.bv",function(t,e){e.element.parents(".form-group").removeClass("has-success"),e.bv.getSubmitButton()&&e.bv.disableSubmitButtons(!1)}).on("error.form.bv",function(t){$('[data-provide="message-error"]',m).empty().append($("<div/>",{class:"bs-callout bs-callout-danger",text:"Проверьте поля формы"})),n.button("reset"),m.data("bootstrapValidator").disableSubmitButtons(!0),t.preventDefault()}).on("success.form.bv",function(t){n.button("loading"),m.calculator("submit"),t.preventDefault()}).on("change",'[name="cityFrom"]',function(){var t=parseInt($(this).val()),r=$(e.data("target")).empty();$.getJSON("https://api2.nrg-tk.ru/v2/cities/"+t+"/extraservices").done(function(t){var o;$.each(t,function(t,e){var a="city-from-service",i=a+"-"+e.id;o=c.clone().removeAttr("data-template").attr("data-provide",a);var n=$("input",o).attr("id",i).attr("name",a).attr("value",e.id);$("label",o).attr("for",i).text(e.serviceName).prepend(n),r.prepend(o)}),o&&e.show()})}).on("change",'[data-provide="city-from-service"]',function(){n.addClass("hide"),m.submit()}).on("click",'[data-target="button-add"]',function(){var t=$('[data-provide="item-template"]'),n=t.attr("data-item-index"),e=t.clone().removeClass("hide").removeAttr("data-provide").attr("data-item-index",n||0).attr("data-target","item").css({display:"none"}).insertBefore(t);e.find("[name]").each(function(t,e){var a=$(e),i=a.attr("name");a.attr("name","item."+i+"["+n+"]"),m.data("bootstrapValidator").addField(a.attr("name"),o[i])}),e.css({display:"block",overflow:"hidden"}),e.children('[class^="col"]').css({marginTop:-e.outerHeight(!0)}).animate({marginTop:0},200),t.attr("data-item-index",++n),$('[data-target="item"]').trigger("add.button.etc")}).on("click",'[data-target="button-remove"]',function(t){var e=$(this).parents('[data-target="item"]');e.is('[data-target="item"]')||(e=$(".item-control").find('[data-target="item"]').last()),e.find('[name^="item"]').each(function(t,e){var a=$(e);m.data("bootstrapValidator").removeField(a.attr("name"))}),e.children('[class^="col"]').animate({marginTop:-e.outerHeight(!0)},200,function(){e.remove(),$('[data-target="item"]').trigger("del.button.etc")})}).on("keyup",'[data-provide="total-item"]',function(){m.calculator("destroyResult"),n.removeClass("hide")}).on("keyup add.button.etc del.button.etc",'[data-target="item"]',function(){var t=$('[data-target="item"]'),d=0,s=0,u=0;t.each(function(t,e){var a=$(e),i=a.find('input[name*="places"]'),n=a.find('input[name*="weight"]'),o=a.find('input[name*="volume"]'),r=parseInt(i.val())||0,c=parseFloat(n.val())||0,l=parseFloat(o.val())||0;d+=r,s+=r*c,u+=r*l,$('input[name="totalPlaces"]').val(d),$('input[name="totalWeight"]').val(Math.round(1e3*s)/1e3),$('input[name="totalVolume"]').val(Math.round(1e3*u)/1e3)}),m.calculator("destroyResult"),n.removeClass("hide")}).on("keyup ","input[data-profile]",function(){var t=$(this).parents('[data-target="item"]'),e=1;$("input[data-profile]",t).each(function(){e*=parseFloat($(this).val())||0}),$('[name^="item.volume"]',t).val(Math.round(1e3*e)/1e3),m.data("bootstrapValidator").revalidateField($('[name^="item.volume"]',t))}).on("keyup",'input[name^="item.volume"]',function(){var t=$(this).parents('[data-target="item"]'),e=parseFloat($(this).val())||0,a=parseFloat(Math.pow(e,1/3))||0;a=Math.round(a);var i=e/Math.pow(a,2);isNaN(i)?i=0:1/0===i&&(i=a=Math.pow(e,1/3)),$('input[name^="item.width"]',t).val(Math.round(1e3*a)/1e3),$('input[name^="item.height"]',t).val(Math.round(1e3*a)/1e3),$('input[name^="item.length"]',t).val(Math.round(1e3*i)/1e3),m.data("bootstrapValidator").revalidateField($("[data-profile]",t))}).on("keyup",'input[name^="city"]',function(){m.calculator("destroyResult"),n.removeClass("hide")}).on("submit",function(){var t=0,e=0;$('[data-target="item"]',m).each(function(){e=parseInt($(this).find('input[name^="item.places"]').val()),t=e+t,$(this).data("item-index",t-1),$(this).attr("data-item-index",t-1)})}).on("change",'[name="cover"]',function(){1===parseInt($(this).val())?$(".item-control").hide():$(".item-control").show(),n.addClass("hide"),m.submit()}).on("init.etc.calculator",function(t,e){if(void 0!==localStorage.currentCity){var a=JSON.parse(localStorage.currentCity);m.find('[name="cityFrom"]').val(parseInt(a.city_id)).end().find('[name="cityFromName"]').typeahead("setDefault",{id:parseInt(a.city_id),name:a.name})}var i=location.hash;if(i){var n=$.trim(decodeURI(i.substring(1))),o="";try{o=window.atob(n)}catch(t){return}var r=JSON.parse(o),c=parseInt(r.cityFrom)||0,l=parseInt(r.cityTo)||0,d=parseFloat(r.weight)||.1,s=parseFloat(r.volume)||.001;m.find('[name="cityFrom"]').val(c).end().find('[name="cityFromName"]').typeahead("setDefault",{id:c,name:m.find('[name="cityFrom"] option:selected').text()}).end().find('[name="cityTo"]').val(l).end().find('[name="cityToName"]').typeahead("setDefault",{id:l,name:m.find('[name="cityTo"] option:selected').text()}).end().find('[name="item.weight"]').val(d).end().find('[name="totalWeight"]').val(d).end().find('[name="item.volume"]').val(s).end().find('[name="totalVolume"]').val(s).end().find('[name="item.length"]').val(s).end().find('[name="item.width"]').val(1).end().find('[name="item.height"]').val(1).end().trigger("submit")}}).on("done.cities.etc.calculator",function(t,e){function a(t){$(t.target).typeahead("lookup")}function i(t){var e=$(t.target),a=$('[name="'+e.data("target")+'"]',m),i=e.typeahead("getActive");void 0===i?a.val(0):(e.val(i.name),a.val(i.id)),t.data.data("bootstrapValidator").revalidateField(a)}var n=m.find('[data-provide="cityFromName"]',m),o=m.find('[data-provide="cityToName"]',m);n.typeahead({source:e,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$('[name="cityFrom"]',m).val(t.id),m.data("bootstrapValidator").revalidateField($('[name="cityFrom"]',m)),$('[name="cityFrom"]',m).trigger("change")},matcher:function(t){return~$.trim(this.displayText(t)).toLowerCase().indexOf($.trim(this.query.toLowerCase()))}}).on({paste:a}).on("blur",m,i),o.typeahead({source:e,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$('[name="cityTo"]',m).val(t.id),m.data("bootstrapValidator").revalidateField($('[name="cityTo"]',m)),$('[name="cityTo"]',m).trigger("change")},matcher:function(t){return~$.trim(this.displayText(t)).toLowerCase().indexOf($.trim(this.query.toLowerCase()))}}).on({paste:a}).on("blur",m,i)}).on("fail.cities.etc.calculator",function(t,e){m.before($("<div/>",{class:"bs-callout bs-callout-danger",text:"Ошибка при загрузке списка городов"}))}).on("done.currency.etc.calculator",function(t,e){var a=$('[data-target="currency"]',m),i=$("> a",a),n=$("ul",a).empty();$.each(e,function(){var t=!1,e="";!0===this.default&&(t=this.default,e="hidden"),$("<li/>",{html:$("<a/>",{href:"#",text:this.title,class:e,"data-currency-id":this.id,"data-currency-abbr":this.abbr,"data-currency-title":this.title,"data-currency-default":t})}).appendTo(n)}),i.contents()[0].textContent=n.find('[data-currency-default="true"]').data("currency-title")+" ",n.on("click","a",function(t){t.preventDefault(),n.find("a").removeClass("hidden").attr("data-currency-default",!1),i.contents()[0].textContent=$(t.target).addClass("hidden").attr("data-currency-default",!0).data("currency-title")+" ",$('[name="currency"]').val(n.find('[data-currency-default="true"]').data("currency-id")),a.trigger("change.currency.etc")})}).on("fail.currency.etc.calculator",function(){m.find('[data-target="currency"]').addClass("text-danger").text("Ошибка при загрузке курса валют")}).on("change.currency.etc",'[data-target="currency"]',function(){m.submit()}).on("always.result.etc.calculator",function(t,e){n.button("reset")}).on("fail.result.etc.calculator",function(t,e,a,i){n.removeClass("hide"),$("#onlineApp").addClass("hide")}).on("show.result.etc.calculator",function(t,e,a){m.find(".help-block.text-warning").remove(),m.$currency=m.find('[data-target="currency"]').detach().removeClass("hidden"),n.addClass("hide")}).on("shown.result.etc.calculator",function(t,e,a){a.css({display:"block"}).find('[data-result="currency"]').html(m.$currency),$('[data-spincrement="true"]',a).spincrement({decimalPlaces:2,decimalPoint:",",thousandSeparator:" "});var i=a.find('[data-result="price"]').parent("td").css({cursor:"pointer"}),n=i.eq(0).removeClass("action").addClass("info").index(),o=a.find('[data-result="priceTotal"]').closest("td");o.addClass("hide").attr("colspan",o.length).eq(n-1).removeClass("hide"),i.on("click",function(){i.addClass("action").removeClass("info");var t=$(this).removeClass("action").addClass("info").index(),e=o.addClass("hide").eq(t-1).removeClass("hide"),a=e.find('[data-result="priceTotal"]');a.spincrement({to:a.data("price-total"),decimalPlaces:2,decimalPoint:",",thousandSeparator:" "}),e.find('[data-result="priceTotalAll"]').spincrement({to:a.data("price-total-all"),decimalPlaces:2,decimalPoint:",",thousandSeparator:" "})}),e.cityFrom=parseInt(m.find('[name="cityFrom"]').val()),e.cityTo=parseInt(m.find('[name="cityTo"]').val()),delete e.delivery,delete e.priceInsurance,delete e.request,delete e.transfer;var r,c,l=JSON.stringify(e,null),d=window.btoa(l),s=$("#onlineApp").attr("href"),u=(r=s,(c=document.createElement("a")).href=r,c);u.hash="",$("#onlineApp").attr("href",u.href+"#"+d),$("#onlineApp").removeClass("hide")}).on("destroy.result.etc.calculator",function(t,e){e.css({display:"none"}),m.$currency=m.find('[data-target="currency"]').detach().removeClass("hidden"),m.append(m.$currency.addClass("hidden"))}).on("destroyed.result.etc.calculator",function(t,e){$("#onlineApp").addClass("hide")})}}),$(function(){if(jQuery().calculatorRegion){function t(){}t.prototype={city:{excluded:!1,onSuccess:function(t,e){var a=$(t.target).data("target"),i=$('[name="'+a+'"]');e.bv.updateStatus(i,"VALID").validateField(i)},onError:function(t,e){var a=$(t.target).data("target"),i=$('[name="'+a+'"]');e.bv.updateStatus(i,"INVALID").validateField(i).updateMessage(i,"notEmpty","Пожалуйста, введите город!"),e.element.data("bv.messages").find('.help-block[data-bv-for="'+e.field+'"]').hide()},validators:{notEmpty:{},numeric:{message:"Пожалуйста, выберите город"}}}};var e=new t,n=$('[data-target="calculatorRegion"]'),a=n.find('[type="submit"]');n.calculatorRegion({submitButton:!1}).bootstrapValidator({feedbackIcons:{valid:null,invalid:null,validating:null},fields:{cityFrom:e.city,cityTo:e.city,cityFromName:{validators:{notEmpty:{}}},cityToName:{validators:{notEmpty:{}}}},submitButtons:'[type="submit"]'}).on("success.field.bv",function(t,e){e.element.parents(".form-group").removeClass("has-success"),e.bv.getSubmitButton()&&e.bv.disableSubmitButtons(!1)}).on("success.form.bv",function(t){a.button("loading"),n.calculatorRegion("submit"),t.preventDefault()}).on("init.etc.calculatorRegion",function(t,e){if(void 0!==localStorage.currentCity){var a=JSON.parse(localStorage.currentCity);n.find('[name="cityFrom"]').val(parseInt(a.city_id)).end().find('[name="cityFromName"]').typeahead("setDefault",{id:parseInt(a.city_id),name:a.name})}}).on("done.cities.etc.calculatorRegion",function(t,e){n.find('[data-provide="cityFromName"]',n).typeahead({source:e,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$('[name="cityFrom"]',n).val(t.id),n.data("bootstrapValidator").revalidateField($('[name="cityFrom"]',n))},matcher:function(t){return~$.trim(this.displayText(t)).split("-")[0].toLowerCase().indexOf($.trim(this.query.toLowerCase()))}}).on({paste:function(t){$(t.target).typeahead("lookup")}}).on("blur",n,function(t){var e=$(t.target),a=$('[name="'+e.data("target")+'"]'),i=e.typeahead("getActive");void 0===i?a.val(0):(e.val(i.name),a.val(i.id)),t.data.data("bootstrapValidator").revalidateField(a)})}).on("done.cityPost.etc.calculatorRegion",function(t,e){n.find('[data-provide="cityToName"]',n).typeahead({source:e,autoSelect:!0,fitToElement:!1,changeInputOnMove:!1,afterSelect:function(t){$('[name="cityTo"]',n).val(t.id),n.data("bootstrapValidator").revalidateField($('[name="cityTo"]',n))},select:function(){var t=this.$menu.find(".active").data("value");if(this.$element.data("active",t),this.autoSelect||t){var e=this.updater(t);if(e=e||"",this.changeInputOnSelect){$(this.displayText(e)).text();this.$element.val(e.name).text(e.name).change()}this.followLinkOnSelect&&this.itemLink(t)?(this.openLinkInNewTab?window.open(this.itemLink(t),"_blank"):document.location=this.itemLink(t),this.afterSelect(e)):this.followLinkOnSelect&&!this.itemLink(t)?this.afterEmptySelect(e):this.afterSelect(e)}else this.afterEmptySelect();return this.hide()},displayText:function(t){var e=[t.name,t.region,t.area];return'<small class="h5"><strong>'+(e=e.filter(function(t){if(0!==t.length)return t})).join("-")+"</strong></small>"}}).on({paste:function(t){$(t.target).typeahead("lookup")}}).on("blur",n,function(t){var e=$(t.target),a=$('[name="'+e.data("target")+'"]',n),i=e.typeahead("getActive");void 0===i?a.val(0):(e.val(i.name),a.val(i.id)),t.data.data("bootstrapValidator").revalidateField(a)})}).on("show.result.etc.calculatorRegion",function(t,e,a){}).on("always.result.etc.calculatorRegion",function(t,e){a.button("reset")})}}),$(function(){var e=$('[data-target="affix"]');e.affix({offset:{top:function(){var t=e.offset().top;return this.top=t},bottom:function(){var t=$("footer").outerHeight(!0)+parseInt($("main").css("padding-bottom"));return this.bottom=t}}}).on("affixed.bs.affix",function(){e.width(e.parent().width())}),$(window).on("resize",function(){e.width(e.parent().width())})}),$(function(){if(jQuery().widget){var t=$('[id^="etcCalculator"]').find("form"),e=$('[id^="etcTracking"]').find("form");t.on("init.etc.widget",function(t){function a(t){$(t.target).typeahead("lookup")}function i(t){return~$.trim(this.displayText(t)).toLowerCase().indexOf($.trim(this.query.toLowerCase()))}function n(t){var e=$(t.target),a=e.typeahead("getActive");e.val(a.name)}var o=$(t.target),r=o.find('[data-provide^="cityFrom"]'),c=o.find('[data-provide^="cityTo"]');$.getJSON("https://api2.nrg-tk.ru/v2/cities").done(function(t){if(t.cityList){if(r.typeahead({source:t.cityList,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$('[name="cityFrom"]',o).val(t.id)},matcher:i}).on({paste:a}).on({blur:n}),void 0!==localStorage.currentCity){var e=JSON.parse(localStorage.currentCity);o.find('[name="cityFrom"]').val(parseInt(e.city_id)),r.typeahead("setDefault",{id:parseInt(e.city_id),name:e.name})}c.typeahead({source:t.cityList,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$('[name="cityTo"]',o).val(t.id)},matcher:i}).on({paste:a}).on({blur:n})}})}),t.widget("calculator"),e.widget("tracking")}}),$(function(){$(document).on("load.etc.cities.overlay",function(){var a=window.localStorage,i=$(".etc-cities-overlay");if(void 0!==a&&a.cities)try{var t=JSON.parse(a.cities),e=t.timestamp;if((new Date).getTime().toString()-e<12e4)return void i.append($.parseHTML(t.value))}catch(t){}var n=$('a[data-toggle="etc-cities-overlay"]');n.data("loading",!0),$.ajax({url:n.attr("href"),cache:!1}).done(function(t){if(t){var e={value:t,timestamp:(new Date).getTime()};void 0!==a&&(a.cities=JSON.stringify(e)),n.data("loading",!1),i.append(t),$(document).trigger("search.etc.cities").trigger("choice.etc.cities.letter")}})}).on("search.etc.cities",function(){var t=$('[data-provide="etc-cities-search"]'),e=t.data("cities");e&&t.typeahead({source:e,autoSelect:!0,fitToElement:!0,afterSelect:function(t){$(document).trigger("selected.etc.city",[JSON.stringify(t)]);var e="//"+window.location.hostname+t.url;window.location.replace(e)},matcher:function(t){return~$.trim(this.displayText(t)).toLowerCase().indexOf($.trim(this.query.toLowerCase()))}}).on({paste:function(t){$(t.target).typeahead("lookup")}}).on({blur:function(t){var e=$(t.target),a=e.typeahead("getActive");"object"==typeof a&&e.val(a.name)}})}).on("choice.etc.cities.letter",function(){$('[data-provide="etc-cities-letter-choice"]').on("click",function(t){t.preventDefault();var e=$(t.target),a=$(this);if(e.is('[data-target="cities-letter"]')){$(this).find('[class="active"]').removeClass("active in"),e.parent().addClass("active");var i=$.trim(e.text());$("[data-cities-letter]",a.parent()).addClass("visible-xs").children(".row").removeClass("fade in");var n=$('[data-cities-letter="'+i+'"]',a.parent());n.removeClass("visible-xs").children(".row").addClass("fade"),setTimeout(function(){n.children(".row").addClass("in")},100)}}),$('[data-provide="etc-city"]').on("click",function(t){var e=JSON.stringify($(this).data("city"));$(document).trigger("selected.etc.city",[e])})}).trigger("load.etc.cities.overlay"),$(".etc-cities").length&&$(document).trigger("search.etc.cities").trigger("choice.etc.cities.letter");function t(t){function e(t){return("0"+t).slice(-2)}var a,i=[],n=new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond),o=n.getHours(),r=n.getMinutes(),c=n.getSeconds();return a="<span "+((c%=2)?"":'style="visibility:hidden"')+">:</span>",i.push(e(o)),i.push(e(r)),i.join(a)}var e=$('[data-provide="etc-city-watch"]'),a=e.data("datetime");if(void 0!==a&&setInterval(function(){++a.second,e.html(t(a))},1e3),$('[data-provide="etc-city-address-email"]').each(function(t,e){var a=$(e),i=JSON.parse(JSON.stringify($(e).data("email")));if(i){var n=i.name+"@"+i.host;a.html($("<a />",{href:"mailto:"+n,text:n}))}}),$(document).on("toggle.etc.cities.overlay",function(){var t=$('[data-toggle="etc-cities-overlay"] i:eq(0)');if(!t.is(".fa-map-marker"))return!1;var e=setInterval(function(){$('[data-toggle="etc-cities-overlay"]').data("loading")?t.removeClass("fa fa-map-marker").addClass("fa fa-circle-o-notch fa-spin fa-fw"):(clearInterval(e),$("body").toggleClass("etc-cities-overlay-open"),$('[data-provide="etc-cities-search"]').focus(),t.removeClass("fa fa-circle-o-notch fa-spin fa-fw").addClass("fa fa-map-marker"))},100)}),$('[data-toggle="etc-cities-overlay"]').on("click",function(t){t.preventDefault(),$(document).trigger("toggle.etc.cities.overlay")}),$(document).keydown(function(t){45===t.which&&$(document).trigger("toggle.etc.cities.overlay")}),"undefined"!=typeof localStorage){$(document).on("selected.etc.city",function(t,e){localStorage.currentCity=e}),localStorage.currentCity;try{var i=JSON.parse(localStorage.currentCity);$('[data-toggle="etc-cities-overlay"]').is('[data-toggle="etc-cities-overlay"]')&&($('[data-toggle="etc-cities-overlay"]').contents()[2].textContent=" "+i.name+" ")}catch(t){}}var n=$('[data-provide="etc-city-tabs"]');if(n.length){var o=location.hash;o&&$('a[href="'+o+'"]',n).tab("show"),n.on("click","a",function(t){var e=$(t.target).attr("href");(o=e.split("#")[1])&&(location.hash=o)})}}),$(function(){var m=$("[name='applyonline-form']");jQuery().datepicker&&$("[name='applyonline[date]']",m).datepicker({format:"dd.mm.yyyy",startDate:"-infinity",language:"ru",orientation:"bottom left",autoclose:!0,todayHighlight:!0}),jQuery().mask&&$("[name^='applyonline[sender][time']",m).mask("00:00"),$('[name="applyonline[cargo][type]"]',m).on("change",function(t){$(this).is(":checked")&&(1===parseInt($(this).val())?$('[data-provide="cargo-characteristics"]').hide():$('[data-provide="cargo-characteristics"]').show())}).trigger("change"),$('[name="applyonline[payer]"]',m).on("change",function(t,e){var a=$(this).val();e&&(a=""),"third"===a?$('[data-provide="third"]').show():$('[data-provide="third"]').hide()}).trigger("change",[!0]);function t(t){$(t.target).typeahead("lookup")}function e(t){return~$.trim(this.displayText(t)).toLowerCase().indexOf($.trim(this.query.toLowerCase()))}function a(t){var e=$(t.target),a=e.typeahead("getActive");e.val(a.name)}var i=$('[name="applyonline[sender][city]"]'),n=$('[name="applyonline[recipient][city]"]'),p=i.data("cities"),f=n.data("cities");p&&i.typeahead({source:p,autoSelect:!0,fitToElement:!0,afterSelect:function(t){this.$element.trigger("selected.etc.cityId",[t])},matcher:e}).on({paste:t}).on({blur:a}),f&&n.typeahead({source:f,autoSelect:!0,fitToElement:!0,afterSelect:function(t){this.$element.trigger("selected.etc.cityId",[t])},matcher:e}).on({paste:t}).on({blur:a}),m.on("selected.etc.cityId",function(t,e){$('[name="'+$(t.target).data("target")+'"]').val(e.city_id||e.id)}),m.on("submit",function(){$('[name="apply"]').button("loading")}),m.on("init.etc.applyonline",function(t){if(void 0!==localStorage.currentCity){try{var e=JSON.parse(localStorage.currentCity)}catch(t){return}m.find('[name="applyonline[sender][city_id]"]').val(parseInt(e.city_id)).end().find('[name="applyonline[sender][city]"]').typeahead("setDefault",{id:parseInt(e.city_id),name:e.name})}var a=location.hash;if(a){var i=$.trim(decodeURI(a.substring(1))),n="";try{n=window.atob(i)}catch(t){return}try{var o=JSON.parse(n)}catch(t){return}var r=parseInt(o.cover),c=parseInt(o.cityFrom)||0,l=parseInt(o.cityTo)||0,d=parseInt(o.places)||1,s=parseFloat(o.weight)||.1,u=parseFloat(o.volume)||.001;$('[name="applyonline[cargo][type]"]',m).each(function(){var t=$(this);t.val()==r&&t.trigger("click",[r])}),m.find('[name="applyonline[sender][city_id]"]').val(c).end().find('[name="applyonline[sender][city]"]').typeahead("setDefault",{id:c,name:$.map(p,function(t){return t.city_id!=c||t.PROPERTY_CITY_PRICE_ID?null:t.name})}).end().find('[name="applyonline[recipient][city_id]"]').val(l).end().find('[name="applyonline[recipient][city]"]').typeahead("setDefault",{id:l,name:$.map(f,function(t){return t.city_id!=l||t.PROPERTY_CITY_PRICE_ID?null:t.name})}).end().find('[name="applyonline[cargo][total_places]"]').val(d).end().find('[name="applyonline[cargo][total_weight]"]').val(s).end().find('[name="applyonline[cargo][total_volume]"]').val(u)}}).trigger("init.etc.applyonline")}),$(function(){jQuery().YTPlayer&&$("#bgndVideo").YTPlayer()}),$(function(){if("undefined"!=typeof ymaps&&$("#map").length){var d;ymaps.ready(function(){d=new ymaps.Map("map",{center:[55.76,37.64],zoom:10,controls:["zoomControl","fullscreenControl"]},{suppressMapOpenBlock:!0});var r=new ymaps.GeoObjectCollection;r.events.add("click",function(t){var e=t.get("target");$tab=e.properties.get("tab"),$tab.tab("show"),$('a[href="#address_list"]').tab("show")});function l(t){r.removeAll(),t.each(function(t,e){var a=$(e),i=a.attr("href"),n=$(i).find('a[data-provide="etc-city-address-map"]').data();if(void 0!==n.coordinates){var o=n.coordinates;MyIconContentLayout=ymaps.templateLayoutFactory.createClass('<div style="white-space: nowrap;font: 13px/27px Arial,sans-serif;border-radius: 5px;height: 27px;text-overflow: ellipsis;overflow: hidden;background: rgba(255,255,255,.85);padding: 0 8px 0 0;padding-left: 25px;position: absolute;margin-top: -1px;z-index:-1">$[properties.iconContent]</div>'),r.add(new ymaps.Placemark(o,{tab:a,iconCaption:a.text(),iconContent:a.text()},{iconLayout:"default#imageWithContent",iconImageHref:n.icon,iconImageSize:[55,55],iconContentOffset:[25,5],iconImageOffset:[-28,-45],iconContentLayout:MyIconContentLayout}))}}),d.geoObjects.add(r)}$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){var e=$(t.target);if(!e.is('a[data-provide="etc-city-address-map"]')){var a=e.closest(".dropdown");if(a.length){var i=a.find('a[data-toggle="tab"]');l(i)}else l(e);var n=$(e.attr("href")).find('a[data-provide="etc-city-address-map"]').data();if(void 0!==n.coordinates){var o=n.coordinates;d.setCenter(o,17,{checkZoomRange:!0}),d.container.fitToViewport()}}}),$('a[data-provide="etc-city-address-map"]').on("shown.bs.tab",function(t){var e=$(t.target),a=e.closest(".tab-pane").attr("id"),i=$('a[href="#'+a+'"]'),n=i.closest(".dropdown");if(n.length){var o=n.find('a[data-toggle="tab"]');l(o)}else l(i);var r=e.data();if(void 0!==r.coordinates){var c=r.coordinates;d.setCenter(c,17,{checkZoomRange:!0}),d.container.fitToViewport()}})})}}),$(function(){var t=$(".etc-infobae");$('[data-dismiss="etc-infobae"]').on("click",function(){t.addClass("etc-infobae--close")});var e=$(".owl-carousel",t);e.on("changed.owl.carousel",function(t){var e=t.item.count,a=t.item.index;0===a||e+1<a?a=1:1===a?a=e:--a,$(".etc-infobae__content-count").text(a+" / "+e)}).on("init.owl",function(){e.owlCarousel({loop:!0,items:1,nav:!1,dots:!1,navElement:"i",navClass:["fa fa-angle-left","fa fa-angle-right "],navText:["",""],autoplay:!0,autoplayTimeout:5e3,autoplayHoverPause:!0})}).trigger("init.owl"),$(".etc-infobae__content-btn-next").hover(function(){e.trigger("stop.owl.autoplay")},function(){e.trigger("play.owl.autoplay")}).click(function(){e.trigger("next.owl.carousel")}),$(".etc-infobae__content-btn-prev").hover(function(){e.trigger("stop.owl.autoplay")},function(){e.trigger("play.owl.autoplay")}).click(function(){e.trigger("prev.owl.carousel")})});