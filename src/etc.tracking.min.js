!function($){var $this,settings,defaults={language:{url:""},templates:{error:".bs-callout-danger"},src:{tracking:"https://api2.nrg-tk.ru/v2/sending/state/"}},messages={};$.date=function(t){var e=new Date(t),a=e.getDate(),s=e.getMonth()+1;return a<10&&(a="0"+a),s<10&&(s="0"+s),a+"."+s+"."+e.getFullYear()};var privateMethods={language:{src:"",init:function(t){$.ajax({dataType:"json",url:t,success:function(t){privateMethods.language.set(t)}})},set:function(t){this.src=t},get:function(){return this.src}},translation:{error:function(t){var e=privateMethods.language.get();for(var a in void 0===t&&(t={code:"undefined",message:"undefined"}),e)if(t.code===a){t.message=e[a];break}return t}},flashMessenger:{namespace:"",setNamespace:function(t){return this.namespace=t,messages[this.namespace]||(messages[this.namespace]=[]),this},addMessage:function(t){void 0!==messages&&messages[this.namespace].push(t)},getMessages:function(){var t=messages;return messages={},t},destroy:function(){messages={}}}},methods={init:function(options){$this=$(this);var property=$this.data("property")&&"string"==typeof $this.data("property")?eval("("+$this.data("property")+")"):$this.data("property");return"object"!=typeof property&&(property={}),settings=$.extend(!0,{},defaults,options,property),this.each(function(){privateMethods.language.init(settings.language.url),$this.bind("submit.nrgTracking",function(t){t.preventDefault(),methods.tracking()})})},tracking:function(){var p=$(".etc-tracking-result"),c=$(".etc-tracking-errors");$.ajax({url:settings.src.tracking,method:"GET",data:{docNum:$.trim($('[name="docNum"]',$this).val())},dataType:"json"}).done(function(t){var e=$("<table/>",{class:"table etc-table-no-more"}).append($("<caption/>",{class:"h3",text:"Информация об экспедиторской расписке:"}),$("<thead/>"),$("<tfoot/>"),$("<tbody/>")),s=$("<table/>",{class:"table etc-table-no-more"}).append($("<caption/>",{class:"h3",text:"Текущее состояние:"}),$("<thead/>"),$("<tfoot/>"),$("<tbody/>")),a=["№ расписки","Откуда","Куда","Рейс","Мест","Вес","Объем"],n=["Мест","Состояние"],r=$("<tr/>"),i=$("<tr/>"),o=$("<tr/>");$.each(a,function(){r.append($("<th/>",{html:this}))}),$.each(n,function(){i.append($("<th/>",{text:this}))}),o.append($("<td/>",{"data-title":a[0],text:$('[name="docNum"]',$this).val()}),$("<td/>",{"data-title":a[1],text:t.cityFrom.name}),$("<td/>",{"data-title":a[2],text:t.cityTo.name}),$("<td/>",{"data-title":a[3],text:t.priceTripType.title?t.priceTripType.title:"-"}),$("<td/>",{"data-title":a[4],text:t.places+" шт"}),$("<td/>",{"data-title":a[5],text:t.weight.toFixed(2)+" кг"}),$("<td/>",{"data-title":a[6],html:t.volume.toFixed(2)+" м<sup>3</sup>"})),t.states||(t.states=[{}]),$.each(t.states,function(){var t=$("<tr/>"),e="";switch(this.idState){case 0:e=" создана, груз у отправителя. Будьте внимательны! Не отправляйте предоплату, пока статус накладной не изменится!";break;case 1:e=': <span class="text-nowrap"> '+this.stateInfo.warehouse.title+'; </span> <span class="text-nowrap"> <i class="fa fa-map-marker"></i> '+this.stateInfo.warehouse.address+';</span> <span class="text-nowrap"> <i class="fa fa-volume-control-phone"></i> '+this.stateInfo.warehouse.phone+"</span>";break;case 2:var a=new Date(1e3*this.stateInfo.trip.date);e=": от "+$.date(a)+" "+this.stateInfo.trip.cityFrom.name+"-"+this.stateInfo.trip.cityTo.name;break;case 3:case 10:e="";break;case 20:a=new Date(1e3*this.stateInfo.issued.issueDate);e=": "+this.stateInfo.issued.issueDateFormatted.slice(0,-9)+', на складе "'+this.stateInfo.issued.warehouse.title+'"';break;default:e="Информация отсутствует. За информацией обратитесь к операторам по номеру 8-800-700-7000"}$("tbody",s).append(t.append($("<td/>",{"data-title":n[0],text:this.amount?this.amount+" шт":"-"}),$("<td/>",{"data-title":n[1],html:(this.title?this.title:"")+e})))}),$("thead",e).append(r),$("thead",s).append(i),$("tbody",e).append(o),p.empty().append(e,s),c.empty(),$this.trigger("success.etc.tracking",[t])}).fail(function(t){p.empty(),privateMethods.flashMessenger.setNamespace("errors").addMessage(privateMethods.translation.error(t.responseJSON).message)}).always(function(t){$this.trigger("always.etc.tracking",[t]);var e=$(".etc-tracking-errors").empty(),a=privateMethods.flashMessenger.getMessages();if("object"==typeof a){var s=a.errors;if($.isArray(s)){var n=$(settings.templates.error).clone().removeClass("hide").appendTo(e);$.each(s,function(){n.append($("<p />",{text:this}))})}}})}};$.fn.nrgTracking=function(t){return methods[t]?methods[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void $.error("Метод с именем "+t+" не существует для jQuery.nrgTracking"):methods.init.apply(this,arguments)}}(jQuery);