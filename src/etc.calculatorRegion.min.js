!function($){"use strict";var messages={},Language=function(){this.src="",this.init=function(t){var e=this;$.ajax({dataType:"json",url:t}).done(function(t){e.set(t)}).fail(function(){e.set({})})},this.set=function(t){this.src=t},this.get=function(){return this.src}},Translation=function(){this.language=new Language,this.do=function(t){var e=this.language.get();for(var i in void 0===t&&(t={code:"undefined",message:"undefined"}),e)if(t.code===i){t.message=e[i];break}return t}},FlashMessenger=function(){this.namespace="",this.setNamespace=function(t){return this.namespace=t,messages[this.namespace]||(messages[this.namespace]=[]),this},this.addMessage=function(t){void 0!==messages&&messages[this.namespace].push(t)},this.getMessages=function(){var t=messages;return messages={},t},this.destroy=function(){messages={}}},CalculatorRegion=function(element,options){this.$element=$(element);var property=this.$element.data("property")&&"string"==typeof this.$element.data("property")?eval("("+this.$element.data("property")+")"):this.$element.data("property"),buildInputOptions=function(t){var e=[];return $.each(t,function(){e.push('<option value="'+this.id+'">'+this.name+"</option>")}),e.join("\n")};"object"!=typeof property&&(property={}),this.options=$.extend(!0,{},CalculatorRegion.defaults,options,property),this.translation=new Translation,this.flashMessenger=new FlashMessenger,this.getCities=function(){var a=this.$element,n=$('[name="cityFrom"]',a),t=n.data("cities");if(Array.isArray(t)){var e=buildInputOptions(t);n.append(e).val(n.data("default")||0),setTimeout(function(){a.trigger("done.cities.etc.calculatorRegion",[t])})}else $.getJSON(this.options.cities).done(function(t){var e=t.cityList,i=buildInputOptions(e);n.append(i).val(n.data("default")||0),a.trigger("done.cities.etc.calculatorRegion",[e])}).fail(function(t){a.trigger("fail.cities.etc.calculatorRegion",[t])})},this.getCityPost=function(){var i=this.$element,t=$('[name="cityTo"]',i).data("cities");Array.isArray(t)?setTimeout(function(){i.trigger("done.cityPost.etc.calculatorRegion",[t])}):$.getJSON(this.options.cityPost).done(function(t){var e=t.cities.map(function(t){return t.id=t.idcity,t.name=t.title,t});i.trigger("done.cityPost.etc.calculatorRegion",[e])}).fail(function(t){i.trigger("fail.cityPost.etc.calculatorRegion",[t])})},this.getPrice=function(){var e=this,i=e.$element;$.ajax({url:e.options.price,method:"GET",data:{idCityFrom:parseInt($('[name="cityFrom"]',i).val()),idCity:parseInt($('[name="cityTo"]',i).val())},dataType:"json"}).done(function(t){e.showResult(t)}).always(function(t){i.trigger("always.result.etc.calculatorRegion",[t])})}};CalculatorRegion.version="1.0.0",CalculatorRegion.prototype.init=function(e){return this.each(function(){var a=$(this),n=a.data("etc.calculatorRegion"),t="object"==typeof e&&e;if("object"!=typeof n){var o=0;$(document).ajaxSuccess(function(t,e,i){switch(i.url){case n.options.cityPost:case n.options.cities:o+=50}100===o&&(o=null,a.trigger("init.etc.calculatorRegion",[n]))}),(n=new CalculatorRegion(this,t)).translation.language.init(n.options.language.url),n.getCities(),n.getCityPost(),!0===n.options.submitButton&&a.on("submit.etc.calculatorRegion",function(t){t.preventDefault(),n.getPrice()}),a.data("etc.calculatorRegion",n)}})},CalculatorRegion.prototype.getOptions=function(){var t=this.$element.data("etc.calculatorRegion");if("object"==typeof t)return t.options},CalculatorRegion.prototype.showResult=function(t){var e=this.$element,i=$.Event("show.result.etc.calculatorRegion"),a=e.find('[data-provide="result"]'),n=" руб.";if(e.trigger(i,[t,a]),i.isDefaultPrevented())return!1;function o(t,e){return t.replace(/\{weightLimit\}/gi,e)}var r=$("<table/>",{class:"table etc-table-no-more"}).append($("<caption/>",{class:"h3",text:"Прайс сельской доставки:"}),$("<thead/>"),$("<tfoot/>"),$("<tbody/>")),s=$("<tr/>"),c=["Тип","Срок доставки","Конверт","Груз до {weightLimit} кг"],l=5,u=10,g=20;s.append($("<th/>",{html:"<small>"+c[0]+"</small>"}),$("<th/>",{html:"<small>"+c[1]+"</small>"}),$("<th/>",{html:"<small>"+c[2]+"</small>"}),$("<th/>",{html:"<small>"+o(c[3],l)+"</small>"}),$("<th/>",{html:"<small>"+o(c[3],u)+"</small>"}),$("<th/>",{html:"<small>"+o(c[3],g)+"</small>"})),$.each(t.reverse(),function(){var t=$("<tr/>"),e=[];$.each(this.priceLimits.reverse(),function(){e[this.weightLimit]=this.priceWeight}),$("tbody",r).append(t.append($("<td/>",{"data-title":c[0],text:this.type}),$("<td/>",{"data-title":c[1],text:this.deliveryTimeFrom+"-"+this.deliveryTimeTo}),$("<td/>",{"data-title":c[2],text:this.priceCover+n}),$("<td/>",{"data-title":o(c[3],l),text:e[l]+n}),$("<td/>",{"data-title":o(c[3],u),text:e[u]+n}),$("<td/>",{"data-title":o(c[3],g),text:e[g]+n})))}),$("thead",r).append(s),a.empty().append(r),e.trigger("shown.result.etc.calculatorRegion",[t,a])},CalculatorRegion.prototype.submit=function(){this.data("etc.calculatorRegion").getPrice()},CalculatorRegion.prototype.destroyResult=function(){var t=this.find('[data-provide="result"]');if(t.length){var e=$.Event("destroy.result.etc.calculatorRegion");if(this.trigger(e,[t]),e.isDefaultPrevented())return!1;t.empty(),this.trigger("destroyed.result.etc.calculatorRegion",[t])}};var old=$.fn.calculatorRegion;$.fn.calculatorRegion=function(t){var e=CalculatorRegion.prototype;return"string"==typeof t&&e[t]?e[t].apply(this,[].slice.call(arguments,1)):"object"!=typeof t&&t?void $.error("The method named "+t+" does not exist for jQuery.calculatorRegion"):e.init.apply(this,arguments)},CalculatorRegion.defaults={cities:"https://api2.nrg-tk.ru/v2/cities",cityPost:"https://api2.nrg-tk.ru/v2/city_post",price:"https://api2.nrg-tk.ru/v2/region_price",language:{url:""},templates:{error:".bs-callout-danger",warning:".bs-callout-warning"},submitButton:!0},$.fn.calculatorRegion.Constructor=CalculatorRegion,$.fn.calculatorRegion.noConflict=function(){return $.fn.calculatorRegion=old,this},$(document).ready(function(t){$('[data-provide^="calculatorRegion"]',document).trigger("click.etc.calculatorRegion.data-api")}).on("click.etc.calculatorRegion.data-api",'[data-provide^="calculatorRegion"]',function(){var t=$(this);t.data("etc.calculatorRegion")||t.calculatorRegion(t.data())})}(jQuery);